# Telegram Bot: –ö–æ–Ω—Ü–µ—Ä—Ç—ã –ú–∏—Ö–∞–∏–ª–∞ –ö—Ä—É–≥–∞ üé∏

–≠—Ç–æ—Ç Telegram-–±–æ—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è "–∫–æ–Ω—Ü–µ—Ä—Ç–∞–º–∏" –ú–∏—Ö–∞–∏–ª–∞ –ö—Ä—É–≥–∞ –≤ —á–∞—Ç–∞—Ö. –ë–æ—Ç –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∫–æ–Ω—Ü–µ—Ä—Ç—ã –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, –∞ —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ü–µ—Ä—Ç–∞–º–∏. –í–æ –≤—Ä–µ–º—è –∫–æ–Ω—Ü–µ—Ä—Ç–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ—Å–æ–æ–±—â–µ–Ω–∏—è (–∫—Ä—É–∂–æ—á–∫–∏).

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –†–µ–∂–∏–º—ã:
- secured - –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –±–æ—Ç–∞ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –≤ —á–∞—Ç—ã —Ç–æ–ª—å–∫–æ —Ç–æ—Ç, –∫—Ç–æ –ø—Ä–æ–ø–∏—Å–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –±–æ—Ç–∞ –≤ —Ñ–∞–π–ª–µ `.env`, —Ç–∞–∫–∂–µ –±–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –∑–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –∫–æ–Ω—Ü–µ—Ä—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, —á–µ–π chat_id —É–∫–∞–∑–∞–Ω –≤ —Ñ–∞–π–ª–µ .env
- public - –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –±–æ—Ç –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –≤ –ª—é–±—ã–µ —á–∞—Ç—ã –∏ –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –µ–≥–æ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —á–∞—Ç–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Ü–µ—Ä—Ç—ã:

- –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 8:00 –ø–æ –ú–æ—Å–∫–≤–µ –±–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ü–µ—Ä—Ç:
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: "–Ø –≤–∫–ª—é—á–∞—é –ú–∏—Ö–∞–∏–ª–∞ –ö—Ä—É–≥–∞"
  - –ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π, –∫—Ä–æ–º–µ –≤–∏–¥–µ–æ—Å–æ–æ–±—â–µ–Ω–∏–π

- –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 23:59 –ø–æ –ú–æ—Å–∫–≤–µ –±–æ—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∫–æ–Ω—Ü–µ—Ä—Ç:
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: "–ö–æ–Ω—Ü–µ—Ä—Ç –ú–∏—Ö–∞–∏–ª–∞ –ö—Ä—É–≥–∞ –æ–∫–æ–Ω—á–µ–Ω, –º–µ–º–∞—Å—ã —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–Ω—ã"
  - –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–∞–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞

### –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ—Ä—Ç–∞–º–∏:

- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ü–µ—Ä—Ç –∫–æ–º–∞–Ω–¥–æ–π `/start_concert`
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ü–µ—Ä—Ç –∫–æ–º–∞–Ω–¥–æ–π `/stop_concert`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

- –í —Ä–µ–∂–∏–º–µ secured –±–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –∑–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –∫–æ–Ω—Ü–µ—Ä—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, —á–µ–π chat_id —É–∫–∞–∑–∞–Ω –≤ —Ñ–∞–π–ª–µ .env
- –í —Ä–µ–∂–∏–º–µ public –±–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –∑–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –∫–æ–Ω—Ü–µ—Ä—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω –∑–∞–ø—É—â–µ–Ω

### –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ cron:

- –ï—Å–ª–∏ –±–æ—Ç –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è, cron –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç –µ–≥–æ —Å–Ω–æ–≤–∞

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ —Å Linux Ubuntu

### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É:

```bash
ssh root@55.55.55.55
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã Python –∏ Git:

```bash
sudo apt update
sudo apt install python3 python3-pip git
```

### 3. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/devilcrowley/mishakrug_tg_bot.git
cd /opt/mishakrug_tg_bot
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Python 3.8 –∏–ª–∏ –≤—ã—à–µ. –ó–∞—Ç–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
python3 -m venv venv
source venv/bin/activate
pip3 install -r requirements.txt
```

### 5. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç—É–¥–∞ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```
MODE=secured
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
ADMIN_CHAT_ID=your_admin_chat_id_here
```

- `TELEGRAM_BOT_TOKEN`: –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç BotFather
- `ADMIN_CHAT_ID`: –í–∞—à chat_id (—É–∑–Ω–∞—Ç—å –µ–≥–æ –º–æ–∂–Ω–æ, –æ—Ç–ø—Ä–∞–≤–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É /start –∏ –ø–æ—Å–º–æ—Ç—Ä–µ–≤ –ª–æ–≥–∏)
- `MODE`: secured –∏–ª–∏ public, –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ —Ä–µ–∂–∏–º—ã


### 6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

- –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ —Å –∑–∞–ø–∏—Å—å—é –ª–æ–≥–æ–≤

```
nohup python3 mishakrug.py > mishakrug.log 2>&1 &
```
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏

```
tail -f mishakrug.log
```

- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞, –Ω–∞–π–¥–∏—Ç–µ –µ–≥–æ PID –∏ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å

```
ps aux | grep python3
kill <PID>
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–ï—Å–ª–∏ –≤—ã –≤–Ω–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –æ–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
cd /opt/mishakrug_tg_bot
git pull origin main
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:

```bash
pkill -f "python3 mishakrug.py"
nohup python3 mishakrug.py > mishakrug.log 2>&1 &
```

## ‚è∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞

–ß—Ç–æ–±—ã –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–ª—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ cron:

1. –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ (check_bot.sh):

```bash
#!/bin/bash

if ! pgrep -f "python3 mishakrug.py"; then
    nohup python3 mishakrug.py > mishakrug.log 2>&1 &
    echo "–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω."
else
    echo "–ë–æ—Ç —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç."
fi
```

2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
chmod +x /opt/mishakrug_tg_bot/check_bot.sh
```

3. –û—Ç–∫—Ä–æ–π—Ç–µ crontab –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
crontab -e
```

4. –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç:

```bash
*/5 * * * * /opt/mishakrug_tg_bot/check_bot.sh >> /opt/mishakrug_tg_bot/cron.log 2>&1
```

5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –∑–∞–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª.

## üõ† –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start_concert` ‚Äî –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ü–µ—Ä—Ç –≤—Ä—É—á–Ω—É—é (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
- `/stop_concert` ‚Äî –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ü–µ—Ä—Ç –≤—Ä—É—á–Ω—É—é (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)


## üôè –í —Ñ–∏–ª—å–º–µ —Å–Ω–∏–º–∞–ª–∏—Å—å
–ò–¥–µ—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞: @borch78
–°–ø–∞—Å–∏–±–æ –ú–∏—Ö–∞–∏–ª—É –ö—Ä—É–≥—É –∑–∞ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ! üé∂
